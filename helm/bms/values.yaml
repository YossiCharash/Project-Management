# Default values for BMS Helm Chart
# This is a YAML-formatted file.

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []

# Backend Configuration
backend:
  enabled: true
  image:
    repository: bms-backend
    tag: "latest"
    pullPolicy: IfNotPresent
  
  replicaCount: 1
  
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
  
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  
  # Environment variables - non-sensitive
  env:
    FILE_UPLOAD_DIR: "/app/uploads"
    SMTP_SERVER: "smtp.gmail.com"
    SMTP_PORT: "587"
    FRONTEND_URL: "http://localhost:80"
  
  # Sensitive environment variables (will be in Secret)
  # IMPORTANT: DATABASE_URL service name format: <release-name>-postgresql
  # If release name is "bms", service will be "bms-postgresql"
  # Update this when installing with a different release name!
  secretEnv:
    DATABASE_URL: "postgresql+asyncpg://postgres:postgres@bms-postgresql:5432/bms"
    JWT_SECRET_KEY: "7aa489fc1614369973a4059a479d6c190b360540"
    SUPER_ADMIN_EMAIL: "c0548508540@gmail.com"
    SUPER_ADMIN_PASSWORD: "c98C98@98"
    SUPER_ADMIN_NAME: "System Admin"
    CORS_ORIGINS: "http://localhost:5174,http://127.0.0.1:5174,http://localhost:5173"
    SMTP_USERNAME: "c0548508540@gmail.com"
    SMTP_PASSWORD: "jaou aarx mljm hdix"
  
  # Persistent volume for uploads
  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi
  
  # Health check
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 40
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 20
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Frontend Configuration
frontend:
  enabled: true
  image:
    repository: bms-frontend
    tag: "latest"
    pullPolicy: IfNotPresent
  
  replicaCount: 1
  
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  # API URL for frontend
  # NOTE: This is for reference only - VITE_API_URL must be set at Docker build time!
  # Service name format: <release-name>-backend
  # If release name is "bms", service will be "bms-backend"
  # When building the frontend image, use: --build-arg VITE_API_URL=http://bms-backend:8000/api/v1
  apiUrl: "http://bms-backend:8000/api/v1"
  
  # Health check
  livenessProbe:
    httpGet:
      path: /
      port: 80
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /
      port: 80
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3

# PostgreSQL Database Configuration
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: "16-alpine"
    pullPolicy: IfNotPresent
  
  replicaCount: 1
  
  service:
    type: ClusterIP
    port: 5432
    targetPort: 5432
  
  # Database credentials
  database: bms
  username: postgres
  password: postgres  # Change this in production!
  
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  
  # Persistent volume for database
  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 20Gi
  
  # Health check
  livenessProbe:
    exec:
      command:
        - /bin/sh
        - -c
        - pg_isready -U postgres
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    exec:
      command:
        - /bin/sh
        - -c
        - pg_isready -U postgres
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# OpenShift Route Configuration
route:
  enabled: true
  # Frontend route
  frontend:
    host: ""  # Will be auto-generated if empty
    tls:
      enabled: true
      termination: edge  # edge, passthrough, or reencrypt
      insecureEdgeTerminationPolicy: Redirect
  # Backend route (optional, for API access)
  backend:
    enabled: false  # Usually backend is accessed via frontend
    host: ""
    tls:
      enabled: true
      termination: edge
      insecureEdgeTerminationPolicy: Redirect

# Security Context for OpenShift
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

# Service Account
serviceAccount:
  create: true
  name: ""

# Node selector, tolerations, and affinity
nodeSelector: {}
tolerations: []
affinity: {}

